import{AnimationControl,SmootScroll,transition,webGL}from"./main.js";export{home};class StickyEffect{static position;static reverse;static options={duration:700,iteration:!1,timing:e=>this.reverse?1-Math.pow(1-e,2.6):Math.sin(e*Math.PI/2),preliminary:()=>webGL.uniform.u_AnimationMode.value=0,draw:e=>{webGL.uniform.u_Distance.value=this.reverse?e<.5?this.position:this.position*(1-e)*2:e<.5?this.position*e*2:this.position,webGL.uniform.u_Distortion.value=this.reverse?e<.5?2.2*e*2:2.2:e<.5?2.2:2.2*(1-e)*2,webGL.data.prepareCanvas(),webGL.data.drawFrame(webGL.program,webGL.geometry,webGL.uniform)}}}class SwayEffect{static cancel;static options={duration:1e3,iteration:!0,timing:e=>e,preliminary:()=>{webGL.uniform.u_AnimationMode.value=1,webGL.uniform.u_Wave.value=7},draw:e=>{!0===this.cancel&&(this.cancel=e),Number.isFinite(this.cancel)&&e>this.cancel+.4?(SwayEffect.cancel=!1,AnimationControl.cancel()):(webGL.uniform.u_Distortion.value=this.cancel?.08*(1-(e-this.cancel)/.4):e<.25?.08*e/.25:.08,webGL.uniform.u_Progress.value=10*e,webGL.data.prepareCanvas(),webGL.data.drawFrame(webGL.program,webGL.geometry,webGL.uniform))}}}class StickySwayEffect{static options={duration:700,iteration:!1,timing:e=>1-(1-e)*(1-e),preliminary:()=>{webGL.uniform.u_AnimationMode.value=1,webGL.uniform.u_Wave.value=10},draw:e=>{webGL.uniform.u_Distortion.value=(e<.5?e:1-e)/6,webGL.uniform.u_Progress.value=6*e,webGL.uniform.u_Band.value=(e<.5?e:1-e)/16,webGL.uniform.u_Matrix.value=Matrix_4x4.multiply(Matrix_4x4.setPerspectiveProjection(),Matrix_4x4.setView(),Matrix_4x4.setTranslate(0,0,.2*e-2.2)),webGL.data.prepareCanvas(),webGL.data.drawFrame(webGL.program,webGL.geometry,webGL.uniform,webGL.texture[0])}}}function home(){let e=0;window.sessionStorage.length?e=+window.sessionStorage.getItem("pageNumber"):window.sessionStorage.setItem("pageNumber",e),preparingAndRunPage(e)}function preparingAndRunPage(e){let t=document.querySelector(".page-"+e),r=document.querySelector(".page-title");if(r.addEventListener("animationend",()=>{let i=document.getElementById("main");i.onanimationend=r=>{"main"==r.target.id&&"/home"==window.location.pathname&&(i.onanimationend=null,onwheel=e>0&&e<4?moveTitle(e,t):moveToPage)},2==e&&(Object.assign(webGL.data.canvas.style,{visibility:"visible",top:parseFloat(getComputedStyle(t).paddingTop)/2+"px"}),AnimationControl.run(StickySwayEffect.options,()=>Object.assign(t.querySelector(".project-source").style,{cursor:"pointer",pointerEvents:"all"}))),t.style.visibility="visible",i.setAttribute("data-state","belowe"),r.classList.remove("show-title")},{once:!0}),document.querySelector(".page-group").style.top=`calc(-100vh * ${e})`,r.querySelector(".title-data").textContent=["hello","services","work","advantages","thank you"][e],r.classList.add("show-title"),e>0&&e<4){let r=t.querySelector(".item-title-group"),i=t.querySelectorAll(".item-title"),a=t.querySelectorAll(".item-content"),o=0;2==e?t.querySelector(".project-source").addEventListener("click",transition):o=-r.offsetParent.offsetTop-r.offsetTop,t.querySelector(".item-title-group").style.transform="matrix(1,0,0,1,0,0)",i.forEach((t,r)=>{r?(2!=e&&a[r].setAttribute("data-state",""),t.style.transform="matrix(1,0,0,1,0,0)",t.removeAttribute("data-enable")):(2!=e&&(t.style.transform=`matrix(1,0,0,1,0,${o})`,a[r].removeAttribute("data-state")),t.setAttribute("data-enable","true"))})}}function moveToPage(e){let t=document.getElementById("main"),r=+window.sessionStorage.getItem("pageNumber"),i=e.deltaY<0?r-1:r+1;if(i>=0&&i<=4){let e=document.querySelector(".page-"+r);window.onwheel=null,window.sessionStorage.setItem("pageNumber",i),t.addEventListener("animationend",()=>{2==r&&(document.getElementById("canvas_webgl").style.visibility="hidden"),t.removeAttribute("data-state"),e.removeAttribute("style"),preparingAndRunPage(i)},{once:!0}),t.setAttribute("data-state","hidden")}}function moveTitle(e,t){let r,i,a,o=document.querySelectorAll(".menu-item:not(.current-item)"),n=t.querySelector(".item-title-group"),s=t.querySelector(".item-title"),l=new SmootScroll(s.parentElement),u=new IntersectionObserver(selectTargetTitle(e),{root:t.querySelector(".item-viewer"),threshold:.5});return o.forEach(e=>e.onclick=()=>{clearTimeout(a);for(let e of o)e.onclick=null}),o=>{let c=t.querySelectorAll(".item-title"),m=t.querySelector(".item-content-group");if(!r){if(r=!0,o.deltaY<0?"true"==s.getAttribute("data-enable"):"true"==c[c.length-1].getAttribute("data-enable"))return onwheel=moveToPage(o);2==e?(t.querySelector(".project-source").classList.add("show-gradient"),Object.assign(StickyEffect,{position:-.75,reverse:!1}),AnimationControl.run(StickyEffect.options),setTimeout(()=>{AnimationControl.cancel(),AnimationControl.run(SwayEffect.options)},550)):m.classList.add("hidden-content"),n.style.height=`calc(${200*(c.length-1)}px + 6.4rem)`,c.forEach(t=>{setTimeout(()=>u.observe(t),200),"true"==t.getAttribute("data-enable")&&(n.addEventListener("transitionend",()=>{document.body.style.height=window.innerHeight+100*(2*c.length-1)+"px",scrollTo(0,i),l.addListener()},{once:!0}),2==e?n.classList.add("show-title-group"):t.style.transform="matrix(1,0,0,1,0,0)")})}clearTimeout(a),a=setTimeout(()=>{let a=()=>{c.forEach((r,i)=>{let a=t.querySelectorAll(".item-content");"true"==r.getAttribute("data-enable")?2!==e?(setTimeout(()=>a[i].setAttribute("data-state","above"),300),a[i].setAttribute("data-state",""),r.style.transform=`matrix(1,0,0,1,0,${document.querySelector(".group-wrapper").offsetTop-r.getBoundingClientRect().top})`):n.classList.remove("show-title-group"):(2!==e&&a[i].setAttribute("data-state",""),r.removeAttribute("data-enable")),u.unobserve(r)})};i=window.scrollY,document.body.style.height=0,l.removeListener(),2==e?(SwayEffect.cancel=!0,setTimeout(()=>{t.querySelector(".project-source").classList.remove("show-gradient"),StickyEffect.reverse=!0,AnimationControl.run(StickyEffect.options,()=>r=!1)},400),setTimeout(a,500)):(r=!1,m.classList.remove("hidden-content"),a())},2==e?2500:1500)}}function selectTargetTitle(e){let t=0;return r=>{for(let i of r)if(i.isIntersecting){if("false"==i.target.getAttribute("data-enable")){if(2==e){let e=i.target.getAttribute("data-id");document.querySelector(".project-source").setAttribute("href",i.target.textContent.replace(" ","_")),webGL.data.defineTextureSlot(webGL.program,{u_Sampler_1:{type:"int",value:1}},webGL.texture[e]),webGL.data.defineTextureSlot(webGL.program,{u_Sampler_0:{type:"int",value:0}},webGL.texture[t]),AnimationControl.run({duration:300,iteration:!1,timing:e=>1-(1-e)*(1-e),draw:e=>{webGL.data.prepareCanvas(),webGL.data.drawFrame(webGL.program,webGL.geometry,{u_Alpha:{type:"float",value:e}})}}),t=e}i.target.setAttribute("data-enable","true")}}else i.target.setAttribute("data-enable","false")}}